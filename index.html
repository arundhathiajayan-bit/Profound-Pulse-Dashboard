<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rokt — Profound Pulse Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  :root {
    --beetroot: #E0004D;
    --beetroot-dark: #B8003D;
    --beetroot-light: #FFF0F5;
    --dark: #1A1A2E;
    --grey-900: #212529;
    --grey-700: #495057;
    --grey-400: #ADB5BD;
    --grey-200: #E9ECEF;
    --grey-100: #F8F9FA;
    --white: #FFFFFF;
    --green: #2ECC71;
    --red: #E74C3C;
    --amber: #F39C12;
    --blue: #3498DB;
    --purple: #7D3C98;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--grey-100); color: var(--grey-900); line-height: 1.5; }

  .header { background: var(--beetroot); color: var(--white); padding: 24px 40px; display: flex; align-items: center; justify-content: space-between; }
  .header-left { display: flex; align-items: center; gap: 14px; }
  .header-logo { width: 34px; height: 34px; background: rgba(255,255,255,0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 15px; }
  .header h1 { font-size: 20px; font-weight: 600; letter-spacing: -0.3px; }
  .header-sub { font-size: 12px; opacity: 0.8; margin-top: 1px; }
  .header-meta { font-size: 13px; opacity: 0.85; }

  .nav-tabs { background: var(--white); border-bottom: 1px solid var(--grey-200); padding: 0 40px; display: flex; gap: 0; }
  .nav-tab { padding: 14px 20px; font-size: 14px; font-weight: 500; color: var(--grey-700); cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s; }
  .nav-tab:hover { color: var(--grey-900); }
  .nav-tab.active { color: var(--beetroot); border-bottom-color: var(--beetroot); }

  .content { max-width: 1260px; margin: 0 auto; padding: 28px 40px 60px; }
  .tab-content { display: none; }
  .tab-content.active { display: block; }
  .section-title { font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.8px; color: var(--grey-400); margin-bottom: 14px; }

  .week-nav { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; background: var(--white); border-radius: 12px; padding: 16px 22px; border: 1px solid var(--grey-200); }
  .week-nav-center { text-align: center; }
  .week-nav-date { font-size: 18px; font-weight: 700; color: var(--grey-900); }
  .week-nav-range { font-size: 12px; color: var(--grey-400); margin-top: 2px; }
  .week-nav-btn { display: flex; align-items: center; gap: 6px; padding: 8px 16px; border-radius: 8px; font-size: 13px; font-weight: 500; border: 1px solid var(--grey-200); background: var(--white); cursor: pointer; transition: all 0.2s; color: var(--grey-700); }
  .week-nav-btn:hover { background: var(--grey-100); border-color: var(--grey-400); }
  .week-nav-btn:disabled { opacity: 0.3; cursor: default; }
  .week-nav-btn:disabled:hover { background: var(--white); border-color: var(--grey-200); }
  .week-nav-dots { display: flex; gap: 6px; justify-content: center; margin-top: 8px; }
  .week-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--grey-200); cursor: pointer; transition: all 0.2s; }
  .week-dot.active { background: var(--beetroot); width: 20px; border-radius: 4px; }

  .kpi-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 14px; margin-bottom: 24px; }
  .kpi-card { background: var(--white); border-radius: 12px; padding: 18px 20px; border: 1px solid var(--grey-200); transition: box-shadow 0.2s; }
  .kpi-card:hover { box-shadow: 0 2px 12px rgba(0,0,0,0.06); }
  .kpi-label { font-size: 12px; color: var(--grey-700); font-weight: 500; margin-bottom: 4px; display: flex; align-items: center; gap: 5px; }
  .kpi-info { display: inline-flex; align-items: center; justify-content: center; width: 15px; height: 15px; border-radius: 50%; background: var(--grey-200); font-size: 10px; font-weight: 700; color: var(--grey-400); cursor: help; position: relative; flex-shrink: 0; }
  .kpi-info:hover { background: var(--beetroot); color: var(--white); }
  .kpi-tooltip { display: none; position: absolute; bottom: 22px; left: 50%; transform: translateX(-50%); background: var(--dark); color: var(--white); font-size: 11px; font-weight: 400; padding: 8px 12px; border-radius: 6px; width: 220px; text-align: center; line-height: 1.4; z-index: 10; white-space: normal; }
  .kpi-info:hover .kpi-tooltip { display: block; }
  .kpi-value { font-size: 26px; font-weight: 700; color: var(--grey-900); }
  .kpi-delta { font-size: 12px; font-weight: 600; margin-top: 3px; }
  .kpi-delta.up { color: var(--green); }
  .kpi-delta.down { color: var(--red); }
  .kpi-delta.flat { color: var(--grey-400); }
  .kpi-rank { font-size: 11px; color: var(--grey-400); margin-top: 4px; }

  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px; }
  .three-col { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 24px; }
  .card { background: var(--white); border-radius: 12px; padding: 24px; border: 1px solid var(--grey-200); }
  .card h3 { font-size: 15px; font-weight: 600; margin-bottom: 14px; }
  .card-sub { font-size: 12px; color: var(--grey-400); margin: -10px 0 14px; }
  .chart-container { position: relative; height: 260px; }
  .full-card { margin-bottom: 24px; }

  .data-table { width: 100%; border-collapse: collapse; font-size: 13px; }
  .data-table th { text-align: left; font-weight: 600; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--grey-400); padding: 8px 12px; border-bottom: 1px solid var(--grey-200); }
  .data-table td { padding: 10px 12px; border-bottom: 1px solid var(--grey-100); }
  .data-table tr:last-child td { border-bottom: none; }
  .data-table .highlight { background: #FFF8E1; }

  .badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
  .badge-green { background: #E8F8F0; color: #1A9955; }
  .badge-red { background: #FDECEC; color: #C0392B; }
  .badge-amber { background: #FEF5E7; color: #B8860B; }
  .badge-blue { background: #EBF5FB; color: #2471A3; }
  .badge-purple { background: #F4ECF7; color: #7D3C98; }
  .badge-baseline { background: var(--grey-100); color: var(--grey-400); }
  .badge-grey { background: var(--grey-100); color: var(--grey-700); }

  .insight-strip { background: var(--grey-100); border-radius: 10px; padding: 16px 20px; margin-top: 16px; margin-bottom: 16px; }
  .insight-strip-title { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.6px; color: var(--grey-400); margin-bottom: 10px; }
  .insight-item { padding: 8px 0; font-size: 13px; color: var(--grey-700); line-height: 1.55; border-bottom: 1px solid var(--grey-200); }
  .insight-item:last-child { border-bottom: none; }
  .insight-tag { display: inline-block; font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; padding: 2px 6px; border-radius: 3px; margin-right: 6px; vertical-align: middle; }
  .tag-citation { background: #EBF5FB; color: #2471A3; }
  .tag-gap { background: #FDEDEC; color: #C0392B; }
  .tag-platform { background: #F4ECF7; color: #7D3C98; }
  .tag-sentiment { background: #FEF9E7; color: #B7950B; }
  .tag-competition { background: #FDEBD0; color: #BA4A00; }
  .tag-action { background: #E8F8F0; color: #1A9955; }

  .framework-box { background: var(--white); border-radius: 12px; padding: 18px 22px; margin-bottom: 20px; border: 1px solid var(--grey-200); }
  .framework-box.branded-fw { border-left: 4px solid #3498DB; }
  .framework-box.unbranded-fw { border-left: 4px solid #F39C12; }
  .framework-box h4 { font-size: 13px; font-weight: 700; margin-bottom: 4px; color: var(--grey-900); }
  .framework-box p { font-size: 12px; color: var(--grey-700); margin-bottom: 2px; }
  .framework-box .metrics-note { font-size: 11px; color: var(--grey-400); margin-top: 4px; }

  .competitor-bar { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
  .competitor-bar-label { font-size: 12px; font-weight: 600; width: 80px; text-align: right; }
  .competitor-bar-track { flex: 1; height: 24px; background: var(--grey-100); border-radius: 6px; overflow: hidden; position: relative; }
  .competitor-bar-fill { height: 100%; border-radius: 6px; display: flex; align-items: center; padding-left: 8px; font-size: 11px; font-weight: 700; color: var(--white); }
  .competitor-bar-fill.rokt { background: var(--beetroot); }
  .competitor-bar-fill.fluent { background: #3498DB; }
  .competitor-bar-fill.uptick { background: #F39C12; }
  .competitor-bar-fill.thanksCo { background: #7D3C98; }

  .theme-tag { display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 11px; font-weight: 500; margin: 2px 4px 2px 0; }
  .theme-tag.neg { background: #FDECEC; color: #C0392B; }

  /* gap styles handled by table + sov-bar now */

  .inline-insight { background: var(--grey-100); border-radius: 8px; padding: 12px 16px; margin-top: 12px; font-size: 12px; color: var(--grey-700); line-height: 1.5; }
  .inline-insight .insight-tag { vertical-align: middle; }

  .sov-bar-cell { display: flex; align-items: center; gap: 10px; }
  .sov-bar-track { flex: 1; height: 16px; background: var(--grey-100); border-radius: 4px; overflow: hidden; min-width: 80px; }
  .sov-bar-fill { height: 100%; border-radius: 4px; background: var(--beetroot); min-width: 2px; }
  .sov-bar-fill.warning { background: var(--amber); }
  .sov-bar-val { font-size: 13px; font-weight: 700; min-width: 44px; text-align: right; }
  .flag-tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; margin-right: 4px; }
  .flag-sov { background: #FDECEC; color: #C0392B; }
  .flag-sentiment { background: #FEF5E7; color: #B8860B; }
  .flag-competition { background: #FDEBD0; color: #BA4A00; }
  .flag-position { background: #F4ECF7; color: #7D3C98; }
  .topic-insight { background: var(--grey-100); border-radius: 6px; padding: 8px 12px; margin-top: 6px; font-size: 11px; color: var(--grey-700); line-height: 1.45; }
  .topic-insight .insight-tag { font-size: 9px; }

  .tldr-section { background: var(--white); border-radius: 12px; padding: 22px 26px; border: 1px solid var(--grey-200); margin-bottom: 16px; }
  .tldr-section h3 { font-size: 14px; font-weight: 700; margin-bottom: 8px; color: var(--grey-900); display: flex; align-items: center; gap: 8px; }
  .tldr-section p { font-size: 13px; color: var(--grey-700); line-height: 1.6; }
  .tldr-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
  .tldr-dot.green { background: var(--green); }
  .tldr-dot.amber { background: var(--amber); }
  .tldr-dot.red { background: var(--red); }
  .tldr-dot.blue { background: var(--blue); }

  @media (max-width: 900px) {
    .kpi-row { grid-template-columns: repeat(2, 1fr); }
    .two-col, .three-col { grid-template-columns: 1fr; }
    .content { padding: 20px; }
    .header { padding: 20px; }
    .nav-tabs { padding: 0 12px; overflow-x: auto; }
  }
</style>
</head>
<body>

<div class="header">
  <div class="header-left">
    <div class="header-logo">R</div>
    <div>
      <h1>Profound Pulse</h1>
      <div class="header-sub">Rokt's AI Visibility Tracker</div>
    </div>
  </div>
  <div class="header-meta"><span id="lastUpdated">Last updated: End of Week Feb 16, 2025</span></div>
</div>

<div class="nav-tabs">
  <div class="nav-tab active" onclick="switchTab('tldr', this)">Weekly TLDR</div>
  <div class="nav-tab" onclick="switchTab('overview', this)">Overview</div>
  <div class="nav-tab" onclick="switchTab('citations', this)">Citations & Sources</div>
  <div class="nav-tab" onclick="switchTab('competition', this)">Competition</div>
  <div class="nav-tab" onclick="switchTab('gaps', this)">Gaps</div>
</div>

<div class="content">

  <!-- ===================== TAB 0: WEEKLY TLDR ===================== -->
  <div id="tab-tldr" class="tab-content active">

    <div class="week-nav">
      <button class="week-nav-btn" id="prevWeekBtn2" onclick="navigateWeek(-1)"><span>&#8592;</span> Previous</button>
      <div class="week-nav-center">
        <div class="week-nav-date" id="weekDateDisplay2"></div>
        <div class="week-nav-range" id="weekRangeDisplay2"></div>
      </div>
      <button class="week-nav-btn" id="nextWeekBtn2" onclick="navigateWeek(1)">Next <span>&#8594;</span></button>
    </div>

    <div id="tldrContent"></div>

    <div class="card full-card" style="margin-top: 20px; border-left: 4px solid var(--beetroot);">
      <h3 style="margin-bottom: 6px;">Action Tracker</h3>
      <p style="font-size: 13px; color: var(--grey-700); margin-bottom: 10px;">Tracking what's in progress and planned based on these insights.</p>
      <a href="https://docs.google.com/document/d/1WTBhqKbCxqB3bMUAWSZeNL8i0iFLARa8QbIyaFnHv_k/edit?tab=t.wk59pwlk5kor" target="_blank" style="display: inline-flex; align-items: center; gap: 8px; padding: 10px 18px; background: var(--beetroot); color: var(--white); border-radius: 8px; font-size: 13px; font-weight: 600; text-decoration: none; transition: background 0.2s;">
        View Action Tracker &rarr;
      </a>
    </div>
  </div>

  <!-- ===================== TAB 1: OVERVIEW ===================== -->
  <div id="tab-overview" class="tab-content">

    <div class="week-nav">
      <button class="week-nav-btn" id="prevWeekBtn" onclick="navigateWeek(-1)"><span>&#8592;</span> Previous</button>
      <div class="week-nav-center">
        <div class="week-nav-date" id="weekDateDisplay"></div>
        <div class="week-nav-range" id="weekRangeDisplay"></div>
        <div class="week-nav-dots" id="weekDots"></div>
      </div>
      <button class="week-nav-btn" id="nextWeekBtn" onclick="navigateWeek(1)">Next <span>&#8594;</span></button>
    </div>

    <!-- Branded Section -->
    <div class="section-title">Branded Queries Performance</div>
    <div class="framework-box branded-fw">
      <h4>Branded Queries</h4>
      <p>Queries that mention "Rokt" by name (e.g., "What is Rokt Ads?", "Rokt vs Fluent")</p>
      <p><strong>What to watch:</strong> Are LLMs citing rokt.com? Is our content dominating our own brand?</p>
      <div class="metrics-note">Key metrics: Avg Position, Citation Share, Sentiment</div>
    </div>
    <div class="kpi-row" id="kpiBranded"></div>

    <!-- Branded avg position competitors table -->
    <div class="card full-card" id="brandedPositionCard">
      <h3>Average Position — Branded Queries</h3>
      <p class="card-sub">Top 5 assets by average position when someone asks about Rokt by name</p>
      <table class="data-table" id="brandedPositionTable"></table>
    </div>

    <!-- Unbranded Section -->
    <div class="section-title">Non-Branded Queries Performance</div>
    <div class="framework-box unbranded-fw">
      <h4>Non-Branded Queries</h4>
      <p>Category queries that don't mention Rokt (e.g., "best ecommerce checkout tools")</p>
      <p><strong>What to watch:</strong> Is Rokt breaking through in broader category conversations?</p>
      <div class="metrics-note">Key metrics: Visibility, SOV, Citation Share, Sentiment</div>
    </div>
    <div class="kpi-row" id="kpiUnbranded"></div>

    <!-- Charts -->
    <div class="two-col">
      <div class="card">
        <h3>Visibility Score Over Time</h3>
        <div class="chart-container"><canvas id="visibilityChart"></canvas></div>
      </div>
      <div class="card">
        <h3>Share of Voice Over Time</h3>
        <div class="chart-container"><canvas id="sovChart"></canvas></div>
      </div>
    </div>

    <div class="card full-card">
      <h3>Non-Branded Mentions by Platform</h3>
      <p class="card-sub">When someone asks an AI about a topic without mentioning Rokt, how often does each platform still surface Rokt?</p>
      <div class="chart-container" style="height: 240px;"><canvas id="platformChart"></canvas></div>
    </div>

    <!-- Overview insights strip -->
    <div class="insight-strip" id="overviewInsights"></div>
  </div>

  <!-- ===================== TAB 2: CITATIONS ===================== -->
  <div id="tab-citations" class="tab-content">

    <div class="section-title">Citation Share Breakdown</div>
    <p style="font-size: 13px; color: var(--grey-700); margin: -8px 0 20px;">How AI models cite and reference Rokt content across answer engines</p>

    <div class="two-col">
      <div class="card">
        <h3>Citations by Source Type</h3>
        <p class="card-sub">Proportion of AI citations pointing to each content category</p>
        <div class="chart-container"><canvas id="citationPieChart"></canvas></div>
        <div class="inline-insight" id="pieChartInsight"></div>
      </div>
      <div class="card">
        <h3>Top Cited Domains</h3>
        <p class="card-sub">Most frequently cited sources in AI-generated responses</p>
        <table class="data-table" id="topDomainsTable"></table>
        <div class="inline-insight" id="topDomainsInsight"></div>
      </div>
    </div>

    <div class="card full-card">
      <h3>Owned Content Citation Breakdown</h3>
      <p class="card-sub">How Rokt's own web properties are cited across AI responses</p>
      <table class="data-table" id="ownedContentTable"></table>
    </div>

    <div class="card full-card">
      <h3>Non-Branded Citation Share</h3>
      <p class="card-sub">In queries that don't mention Rokt, which domains get cited most?</p>
      <table class="data-table" id="unbrandedCitationTable"></table>
      <div class="inline-insight" id="unbrandedCitInsight"></div>
    </div>
  </div>

  <!-- ===================== TAB 3: COMPETITION ===================== -->
  <div id="tab-competition" class="tab-content">

    <div class="section-title">Share of Voice — Competitive Topic</div>
    <div class="card full-card">
      <h3>SOV: Rokt vs Competitors</h3>
      <p class="card-sub">Share of AI mentions within the <strong>Competitive</strong> topic only (queries comparing companies in the space)</p>
      <div id="sovBars"></div>
      <table class="data-table" style="margin-top: 16px;" id="sovTrendTable"></table>
      <div class="inline-insight" id="sovInsight"></div>
    </div>

    <div class="section-title">Sentiment Comparison by Platform</div>
    <p style="font-size: 13px; color: var(--grey-700); margin: -8px 0 20px;">Positive sentiment rate — cells highlighted where a competitor beats Rokt</p>
    <div class="card full-card">
      <table class="data-table" id="compSentimentPlatformTable"></table>
      <div class="inline-insight" id="sentimentPlatformInsight"></div>
    </div>

    <div class="section-title">Sentiment Comparison by Topic</div>
    <p style="font-size: 13px; color: var(--grey-700); margin: -8px 0 20px;">Positive sentiment rate by topic — highlighted where a competitor beats Rokt</p>
    <div class="card full-card">
      <table class="data-table" id="compSentimentTopicTable"></table>
      <div class="inline-insight" id="sentimentTopicInsight"></div>
    </div>

    <div class="two-col">
      <div class="card">
        <h3>Negative Sentiment Themes</h3>
        <p class="card-sub">What AI models criticize about each company</p>
        <div id="sentimentThemes"></div>
      </div>
      <div class="card">
        <h3>Competitor Topic Spillover</h3>
        <p class="card-sub">Competitors appearing outside of Competitive topic (week-over-week)</p>
        <table class="data-table" id="spilloverTable"></table>
        <div class="inline-insight" id="spilloverInsight"></div>
      </div>
    </div>
  </div>

  <!-- ===================== TAB 4: GAPS ===================== -->
  <div id="tab-gaps" class="tab-content">

    <div class="section-title">Low Performing Topics</div>
    <p style="font-size: 13px; color: var(--grey-700); margin: -8px 0 20px;">Topics where Rokt underperforms — flagged by low SOV, declining sentiment, or competitive losses</p>
    <div class="card full-card" id="lowPerformingCard">
      <table class="data-table" id="lowPerformingTable"></table>
    </div>

    <div class="section-title">Content Gaps</div>
    <p style="font-size: 13px; color: var(--grey-700); margin: -8px 0 20px;">Rokt's negative sentiment themes point to content opportunities</p>
    <div class="card full-card">
      <table class="data-table" id="contentGapsTable"></table>
      <div class="inline-insight" id="contentGapsInsight"></div>
    </div>

    <div class="section-title">Low Sentiment Topics</div>
    <p style="font-size: 13px; color: var(--grey-700); margin: -8px 0 20px;">Topics where Rokt has the lowest positive sentiment rate — competitors beat Rokt</p>
    <div class="card full-card">
      <table class="data-table" id="lowSentimentTable"></table>
    </div>
  </div>

</div>

<script>
// ===== DATA STORE =====
const weekData = [
  {
    weekOf: 'End of Week Feb 9',
    range: 'Feb 9 – Feb 15',
    isBaseline: true,
    branded: {
      visibility: { value: 55.4, delta: null },
      sov: { value: 13.2, delta: null },
      avgPos: { value: 1, delta: null, rank: '#1' },
      citation: { value: 46.8, delta: null, rank: '#1' },
      sentiment: { value: 68.7, delta: null }
    },
    brandedPositionCompetitors: [
      { asset: 'Rokt', pos: 1, delta: null },
      { asset: 'AWS', pos: 2.0, delta: null },
      { asset: 'ThanksCo', pos: 2.0, delta: null },
      { asset: 'Uptick', pos: 2.3, delta: null },
      { asset: 'Modern Health', pos: 2.2, delta: null }
    ],
    unbranded: {
      visibility: { value: 7.5, delta: null },
      sov: { value: 1.3, delta: null },
      avgPos: { value: 3.3, delta: null }
    },
    platforms: {
      labels: ['Google AI Mode','Grok','Google Gemini','ChatGPT','Meta AI','Perplexity','Copilot','AI Overviews'],
      mentions: [4697,4462,3239,2746,1166,1113,1146,1000]
    },
    competition: {
      sov: { rokt: 15.84, fluent: 4.53, uptick: 4.14, thanksCo: 2.94 },
      sentimentByPlatform: {
        'Google AI Overviews': { rokt: 85.7, fluent: null, uptick: null, thanksCo: null },
        'Perplexity': { rokt: 78.1, fluent: null, uptick: null, thanksCo: null },
        'ChatGPT': { rokt: 65.4, fluent: null, uptick: null, thanksCo: null },
        'Microsoft Copilot': { rokt: 61.3, fluent: null, uptick: null, thanksCo: null }
      },
      fluentSpillover: { 'Rokt Product': 11, 'Industry Thought Leadership': 18, 'Persona-Led': 4, 'Rokt Aftersell': 3, 'Rokt Ads': 1 },
      uptickSpillover: { 'Rokt Product': 1, 'Rokt Aftersell': 1 },
      thanksCoSpillover: {}
    },
    insights: {
      overview: [
        { tag: 'platform', label: 'Platform', text: 'Grok strongest visibility (5.81 raw score). Meta AI weakest for non-branded. Sentiment averages 68.7% positive across 4 reporting platforms.' }
      ],
      citations: {
        pieChart: null,
        topDomains: null,
        unbrandedCit: null
      },
      competition: {
        sov: null,
        sentimentPlatform: null,
        sentimentTopic: null,
        spillover: null
      },
      gaps: [
        { tag: 'gap', label: 'Gap', text: 'All product-specific queries show 0% visibility — they were only added in the last 3 days of this period.' }
      ]
    }
  },
  {
    weekOf: 'End of Week Feb 16',
    range: 'Feb 16 – Feb 22',
    isBaseline: false,
    branded: {
      visibility: { value: 60.2, delta: 4.8 },
      sov: { value: 16.7, delta: 3.5 },
      avgPos: { value: 1, delta: 0, rank: '#1' },
      citation: { value: 46, delta: -0.8, rank: '#1' },
      sentiment: { value: 68.7, delta: 0 }
    },
    brandedPositionCompetitors: [
      { asset: 'Rokt', pos: 1, delta: 0 },
      { asset: 'AWS', pos: 2.1, delta: -0.1 },
      { asset: 'ThanksCo', pos: 2.3, delta: -0.3 },
      { asset: 'Uptick', pos: 2.3, delta: 0 },
      { asset: 'Modern Health', pos: 2.3, delta: 0.1 }
    ],
    unbranded: {
      visibility: { value: 7.2, delta: -0.3, rank: '#11' },
      sov: { value: 1.3, delta: 0, rank: '#14 (↓3)' },
      avgPos: { value: 3.5, delta: -0.2, rank: '#10 (↓3)' }
    },
    platforms: {
      labels: ['Google AI Mode','Grok','Google Gemini','AI Overviews','ChatGPT','Meta AI','Perplexity','Copilot'],
      mentions: [6171,5968,4167,3270,2985,1548,1558,1730]
    },
    citationCategories: { owned: 21.5, earned: 8.7, social: 11.4, competition: 1.8, other: 56.6 },
    prevCitationCategories: { owned: 19.8, earned: 9.1, social: 10.8, competition: 2.0, other: 58.3 },
    topDomains: [
      { domain: 'rokt.com', share: 46, delta: -0.8, type: 'Owned', cls: 'badge-green' },
      { domain: 'aftersell.com', share: 5, delta: 0.3, type: 'Third Party', cls: 'badge-amber' },
      { domain: 'glassdoor.com', share: 3, delta: 0, type: 'Social', cls: 'badge-purple' },
      { domain: 'builtin.com', share: 2.9, delta: -0.3, type: 'Earned', cls: 'badge-blue' },
      { domain: 'linkedin.com', share: 2.2, delta: 0.3, type: 'Social', cls: 'badge-purple' },
      { domain: 'docs.rokt.com', share: 3.9, delta: 0.2, type: 'Owned', cls: 'badge-green' },
      { domain: 'reddit.com', share: 1.2, delta: 0, type: 'Social', cls: 'badge-purple' },
      { domain: 'youtube.com', share: 1.2, delta: 0.1, type: 'Social', cls: 'badge-purple' }
    ],
    ownedContent: [
      { type: 'Blog', share: '1,017 citations', topPage: 'What Features Differentiate Rokt' },
      { type: 'Product Pages', share: '2,799 citations', topPage: 'Rokt Thanks (691), Product Overview (561)' },
      { type: 'Docs / Help Center', share: '3,571 citations', topPage: 'docs.rokt.com' },
      { type: 'Homepage', share: '541 citations', topPage: 'rokt.com' }
    ],
    unbrandedCitations: [
      { domain: 'linkedin.com', share: 3.0, delta: -0.2 },
      { domain: 'shopify.com', share: 1.8, delta: -0.2 },
      { domain: 'reddit.com', share: 1.4, delta: 0 },
      { domain: 'rokt.com', share: 1.4, delta: 0, highlight: true },
      { domain: 'bigcommerce.com', share: 1.3, delta: -0.1 },
      { domain: 'stripe.com', share: 1.3, delta: 0.2 }
    ],
    competition: {
      sov: { rokt: 16.08, fluent: 4.61, uptick: 4.11, thanksCo: 2.97 },
      sentimentByPlatform: {
        'Google AI Overviews': { rokt: 83.9, fluent: 77.1, uptick: 83.8, thanksCo: 90.3 },
        'Perplexity': { rokt: 72.9, fluent: 70.9, uptick: 75.1, thanksCo: 66.7 },
        'ChatGPT': { rokt: 64.6, fluent: 62.6, uptick: 66.4, thanksCo: 61.2 },
        'Microsoft Copilot': { rokt: 61.3, fluent: 56.0, uptick: 62.2, thanksCo: 58.9 }
      },
      sentimentByTopic: {
        'Culture': { rokt: 65.9, fluent: 69.9, uptick: 87.1, thanksCo: 79.4 },
        'Persona-Led': { rokt: 67.3, fluent: 70.2, uptick: 73.2, thanksCo: 63.9 },
        'Rokt Product': { rokt: 68.8, fluent: 66.7, uptick: 64.6, thanksCo: 66.7 },
        'Rokt Upcart': { rokt: 69.5, fluent: 63.6, uptick: 74.2, thanksCo: 63.6 },
        'Rokt Pay+': { rokt: 71.4, fluent: 61.2, uptick: 77.5, thanksCo: 54.8 },
        'Competitive': { rokt: 71.8, fluent: 55.1, uptick: 67.4, thanksCo: 66.9 },
        'Rokt Ads': { rokt: 72.3, fluent: 68.8, uptick: 61.8, thanksCo: 63.8 },
        'Rokt Thanks': { rokt: 72.3, fluent: 63.2, uptick: 71.2, thanksCo: 80.9 },
        'Rokt Catalog': { rokt: 76.1, fluent: 58.2, uptick: 63.9, thanksCo: 66.7 },
        'Rokt Aftersell': { rokt: 77.8, fluent: 53.8, uptick: 64.9, thanksCo: 73.9 },
        'Industry Thought Leadership': { rokt: 80.5, fluent: 75.7, uptick: 56.7, thanksCo: 39.4 }
      },
      themes: {
        rokt: ['Integration Complexity','Pricing Transparency','Ecosystem Dependence','Implementation Complexity','Privacy & Data Concerns'],
        fluent: ['Financial Instability','Revenue Declines','Profitability Challenges','Weak Competitive Moat'],
        uptick: ['Integration Complexity','Narrow Scope','Limited Reviews','Not Full-Funnel'],
        thanksCo: ['Limited Reviews','Platform Dependency','Lack of Information','Low Trust Score']
      },
      fluentSpillover: { 'Rokt Product': 26, 'Industry Thought Leadership': 15, 'Persona-Led': 9, 'Rokt Aftersell': 9, 'Rokt Ads': 4 },
      uptickSpillover: { 'Industry Thought Leadership': 2, 'Rokt Product': 1, 'Rokt Catalog': 1, 'Rokt Aftersell': 1 },
      thanksCoSpillover: { 'Rokt Catalog': 1, 'Rokt Thanks': 1 },
      sovByTopic: {
        'Persona-Led': { rokt: 0.85, fluent: 1.66, uptick: 0, thanksCo: 0 },
        'Industry Thought Leadership': { rokt: 0.60, fluent: 0.16, uptick: 0.09, thanksCo: 0 }
      }
    },
    lowSentiment: [
      { topic: 'Culture', rate: 65.9, note: 'All 3 competitors beat Rokt here' },
      { topic: 'Persona-Led', rate: 67.3, note: 'Uptick (73.2%) and Fluent (70.2%) ahead' },
      { topic: 'Rokt Product', rate: 68.8, note: 'Highest volume topic — worth improving' },
      { topic: 'Rokt Upcart', rate: 69.5, note: 'Uptick (74.2%) beats Rokt' }
    ],
    insights: {
      overview: [
        { tag: 'platform', label: 'Platform', text: 'Google AI Overviews is the breakout — unbranded mentions up +227%. Total non-branded mentions rose +40% across all 8 platforms.' },
        { tag: 'sentiment', label: 'Sentiment', text: 'Positive sentiment flat at 68.7%. Perplexity had the biggest drop (-5.3pp). Copilot has the lowest positive sentiment of any platform (61.3%) — nearly 4 in 10 Copilot mentions frame Rokt negatively.' }
      ],
      citations: {
        pieChart: { tag: 'citation', label: 'Citation', text: 'Owned content up to 21.5% of citations (+1.7pp). Competition share dropped from 2.0% to 1.8% — Rokt is gaining relative to competitors in citation coverage.' },
        topDomains: { tag: 'citation', label: 'Citation', text: 'rokt.com dominates at 46% citation share. aftersell.com growing (+0.3pp) while builtin.com declining (-0.3pp). Social channels (LinkedIn, Glassdoor) remain stable.' },
        unbrandedCit: { tag: 'citation', label: 'Citation', text: 'In non-branded queries, rokt.com holds at 1.4% share (6th overall). stripe.com is the only domain growing meaningfully (+0.2pp).' }
      },
      competition: {
        sov: { tag: 'competition', label: 'Competition', text: 'Rokt dominates at 16.08% SOV in Competitive queries — 3.5x more than Fluent (4.61%). All four assets stable week-over-week within the Competitive topic.' },
        sentimentPlatform: { tag: 'competition', label: 'Competition', text: 'ThanksCo beats Rokt on AI Overviews (90.3% vs 83.9%). Uptick beats Rokt on Perplexity, ChatGPT, and Copilot. Rokt leads overall but has platform-specific gaps.' },
        sentimentTopic: { tag: 'competition', label: 'Competition', text: 'Culture is Rokt\'s biggest vulnerability — all 3 competitors beat Rokt (65.9%). Uptick leads on 4 topics including Pay+ (77.5% vs 71.4%).' },
        spillover: { tag: 'competition', label: 'Competition', text: 'Fluent is expanding aggressively outside Competitive: Rokt Product (+136%), Persona-Led (+125%), Aftersell (+200%). They also beat Rokt on Persona-Led SOV (1.66% vs 0.85%).' }
      },
      gaps: [
        { tag: 'gap', label: 'Gap', text: 'Industry Thought Leadership is Rokt\'s weakest topic at 0.6% SOV. rokt.com is 6th in Industry Thought Leadership citations — behind LinkedIn, Forbes, BigCommerce, McKinsey, and Bloomreach.' },
        { tag: 'gap', label: 'Gap', text: 'Rokt\'s top negative themes — Integration Complexity, Pricing Transparency, Ecosystem Dependence — are fixable with targeted content addressing these objections.' }
      ]
    }
  }
];

// TLDR per week
const weekTLDR = [
  // Week 0: Baseline
  [
    { color: 'blue', title: 'Baseline Week', text: 'This is the first week of tracking. All metrics serve as the baseline for future comparisons. Product-specific queries were only added in the last 3 days of this period, so those topics show 0% visibility.' }
  ],
  // Week 1: Feb 16
  [
    { color: 'green', title: 'Branded queries are strong', text: 'Rokt holds the #1 average position and 46% citation share when someone asks an AI about Rokt by name. rokt.com is the dominant source AI models cite, and owned content is growing as a share of total citations. No action needed here — this is a defend-and-maintain position.' },
    { color: 'amber', title: 'Non-branded is where the growth opportunity lives', text: 'Visibility dipped slightly this week, but total AI mentions of Rokt across non-branded queries grew 40%. The market for AI-generated answers is expanding fast — the challenge is growing our share faster than the market. Google AI Overviews was the biggest driver of new mentions this week.' },
    { color: 'amber', title: 'Competitors are small but Fluent is moving', text: 'Rokt leads all competitors by a wide margin on share of voice in competitive queries. However, Fluent is the one to watch — they\'re expanding into Rokt Product, Persona-Led, and Aftersell queries at a rate that outpaces their overall size, and they already hold more share of voice than Rokt on Persona-Led queries.' },
    { color: 'red', title: 'Sentiment has platform and topic blind spots', text: 'Overall sentiment is stable, but Copilot has the lowest positive sentiment of any platform — nearly 4 in 10 mentions frame Rokt negatively there. By topic, Culture is where Rokt is weakest — all three competitors score higher. Uptick in particular beats Rokt on sentiment across several product topics.' },
    { color: 'blue', title: 'Content gaps are actionable', text: 'The most common criticisms AI models surface about Rokt — integration complexity, pricing transparency, and ecosystem dependence — all point to content we can create. Industry Thought Leadership remains the weakest topic by share of voice, and rokt.com is outranked by five other domains in Industry Thought Leadership citations.' }
  ]
];

let currentWeekIdx = weekData.length - 1;

// ===== RENDER FUNCTIONS =====
function deltaHTML(delta, unit, lowerBetter) {
  if (delta === null || delta === undefined) return '<div class="kpi-delta"><span class="badge badge-baseline">Baseline</span></div>';
  if (delta === 0) return '<div class="kpi-delta flat">— No change</div>';
  const isGood = lowerBetter ? delta < 0 : delta > 0;
  const cls = isGood ? 'up' : 'down';
  const sign = delta > 0 ? '+' : '';
  const arrow = isGood ? '↑' : '↓';
  return `<div class="kpi-delta ${cls}">${arrow} ${sign}${delta}${unit || 'pp'} vs. prev</div>`;
}

function renderKPI(containerId, metrics, configs) {
  const el = document.getElementById(containerId);
  el.innerHTML = '';
  configs.forEach(cfg => {
    const m = metrics[cfg.key];
    if (!m) return;
    const card = document.createElement('div');
    card.className = 'kpi-card';
    const rankHTML = m.rank ? `<div class="kpi-rank">Rank: ${m.rank}</div>` : '';
    card.innerHTML = `
      <div class="kpi-label">${cfg.label} <span class="kpi-info">i<span class="kpi-tooltip">${cfg.desc}</span></span></div>
      <div class="kpi-value">${m.value}${cfg.suffix}</div>
      ${deltaHTML(m.delta, cfg.unit, cfg.lowerBetter)}
      ${rankHTML}
    `;
    el.appendChild(card);
  });
}

const brandedConfigs = [
  { key: 'visibility', label: 'Visibility Score', suffix: '%', desc: 'How often Rokt appears in AI-generated answers for branded queries', unit: 'pp' },
  { key: 'sov', label: 'Share of Voice', suffix: '%', desc: 'Rokt mentions relative to all companies in branded AI responses', unit: 'pp' },
  { key: 'avgPos', label: 'Avg Position', suffix: '', desc: 'Average rank of Rokt in branded AI answers. 1 = top position.', lowerBetter: true, unit: ' pos' },
  { key: 'citation', label: 'Citation Share', suffix: '%', desc: 'How often rokt.com is cited as a source in branded AI answers', unit: 'pp' },
  { key: 'sentiment', label: 'Positive Sentiment', suffix: '%', desc: 'Share of branded AI mentions where Rokt is framed positively', unit: 'pp' }
];
const unbrandedConfigs = [
  { key: 'visibility', label: 'Visibility', suffix: '%', desc: 'How often Rokt appears in non-branded AI answers', unit: 'pp' },
  { key: 'sov', label: 'Share of Voice', suffix: '%', desc: 'Rokt SOV in non-branded queries', unit: 'pp' },
  { key: 'avgPos', label: 'Avg Position', suffix: '', desc: 'Average rank in non-branded answers. Lower = better.', lowerBetter: true, unit: '' }
];

function renderWeekNav() {
  const week = weekData[currentWeekIdx];
  document.getElementById('weekDateDisplay').textContent = week.weekOf;
  let rangeText = week.range;
  rangeText += week.isBaseline ? ' · Baseline' : ' · vs. previous week';
  document.getElementById('weekRangeDisplay').textContent = rangeText;
  document.getElementById('prevWeekBtn').disabled = (currentWeekIdx === 0);
  document.getElementById('nextWeekBtn').disabled = (currentWeekIdx === weekData.length - 1);
  const dots = document.getElementById('weekDots');
  dots.innerHTML = '';
  weekData.forEach((w, i) => {
    const d = document.createElement('div');
    d.className = 'week-dot' + (i === currentWeekIdx ? ' active' : '');
    d.onclick = () => { currentWeekIdx = i; updateAll(); };
    dots.appendChild(d);
  });
  document.getElementById('lastUpdated').textContent = 'Last updated: ' + weekData[weekData.length - 1].weekOf;
  // Sync TLDR week nav
  document.getElementById('weekDateDisplay2').textContent = week.weekOf;
  document.getElementById('weekRangeDisplay2').textContent = rangeText;
  document.getElementById('prevWeekBtn2').disabled = (currentWeekIdx === 0);
  document.getElementById('nextWeekBtn2').disabled = (currentWeekIdx === weekData.length - 1);
}

function renderTLDR() {
  const items = weekTLDR[currentWeekIdx] || [];
  const el = document.getElementById('tldrContent');
  if (!items.length) { el.innerHTML = '<div class="tldr-section"><p style="color:var(--grey-400)">No TLDR available for this week.</p></div>'; return; }
  el.innerHTML = items.map(item => `
    <div class="tldr-section">
      <h3><span class="tldr-dot ${item.color}"></span>${item.title}</h3>
      <p>${item.text}</p>
    </div>
  `).join('');
}

function navigateWeek(dir) {
  const n = currentWeekIdx + dir;
  if (n >= 0 && n < weekData.length) { currentWeekIdx = n; updateAll(); }
}

function renderBrandedPosition() {
  const week = weekData[currentWeekIdx];
  if (!week.brandedPositionCompetitors) {
    document.getElementById('brandedPositionCard').style.display = 'none';
    return;
  }
  document.getElementById('brandedPositionCard').style.display = '';
  const el = document.getElementById('brandedPositionTable');
  let html = '<thead><tr><th>Asset</th><th>Avg Position</th><th>Δ</th></tr></thead><tbody>';
  week.brandedPositionCompetitors.forEach(d => {
    const isRokt = d.asset === 'Rokt';
    const name = isRokt ? '<strong>Rokt</strong>' : d.asset;
    let dBadge = '';
    if (d.delta === null) dBadge = '<span class="badge badge-baseline">Baseline</span>';
    else if (d.delta === 0) dBadge = '<span class="badge badge-grey">—</span>';
    else {
      const better = d.delta > 0; // higher position number = worse for avg position, but delta here is position change
      const sign = d.delta > 0 ? '+' : '';
      // For position: negative delta = position improved (moved up), positive = worsened
      const cls = d.delta < 0 ? 'badge-green' : d.delta > 0 ? 'badge-red' : 'badge-grey';
      dBadge = `<span class="badge ${cls}">${sign}${d.delta}</span>`;
    }
    html += `<tr><td>${name}</td><td>${d.pos}</td><td>${dBadge}</td></tr>`;
  });
  el.innerHTML = html + '</tbody>';
}

function fmtDelta(val) {
  if (val === null || val === undefined) return '<span class="badge badge-baseline">Baseline</span>';
  if (val === 0) return '<span class="badge badge-grey">—</span>';
  const sign = val > 0 ? '+' : '';
  const cls = val > 0 ? 'badge-green' : 'badge-red';
  return `<span class="badge ${cls}">${sign}${val}pp</span>`;
}

function renderInsightStrip(containerId, insights) {
  const el = document.getElementById(containerId);
  if (!insights || insights.length === 0) { el.innerHTML = ''; return; }
  let html = '<div class="insight-strip-title">Insights</div>';
  insights.forEach(i => {
    html += `<div class="insight-item"><span class="insight-tag tag-${i.tag}">${i.label}</span> ${i.text}</div>`;
  });
  el.innerHTML = html;
}

function renderInlineInsight(containerId, insight) {
  const el = document.getElementById(containerId);
  if (!insight) { el.innerHTML = ''; return; }
  el.innerHTML = `<span class="insight-tag tag-${insight.tag}">${insight.label}</span> ${insight.text}`;
}

function renderTopDomains() {
  const week = weekData[currentWeekIdx];
  if (!week.topDomains) return;
  const el = document.getElementById('topDomainsTable');
  let html = '<thead><tr><th>Domain</th><th>Share</th><th>Δ</th><th>Type</th></tr></thead><tbody>';
  week.topDomains.forEach(d => {
    let dBadge = '';
    if (d.delta === null || d.delta === undefined) dBadge = '<span class="badge badge-baseline">—</span>';
    else if (d.delta === 0) dBadge = '<span class="badge badge-grey">—</span>';
    else {
      const sign = d.delta > 0 ? '+' : '';
      const cls = d.delta > 0 ? 'badge-green' : 'badge-red';
      dBadge = `<span class="badge ${cls}">${sign}${d.delta}pp</span>`;
    }
    html += `<tr><td>${d.domain}</td><td>${d.share}%</td><td>${dBadge}</td><td><span class="badge ${d.cls}">${d.type}</span></td></tr>`;
  });
  el.innerHTML = html + '</tbody>';
}

function renderOwnedContent() {
  const week = weekData[currentWeekIdx];
  if (!week.ownedContent) return;
  const el = document.getElementById('ownedContentTable');
  let html = '<thead><tr><th>Content Type</th><th>Citations</th><th>Top Page</th></tr></thead><tbody>';
  week.ownedContent.forEach(d => {
    html += `<tr><td>${d.type}</td><td>${d.share}</td><td style="font-size:12px;color:var(--grey-400)">${d.topPage}</td></tr>`;
  });
  el.innerHTML = html + '</tbody>';
}

function renderUnbrandedCitations() {
  const week = weekData[currentWeekIdx];
  if (!week.unbrandedCitations) return;
  const el = document.getElementById('unbrandedCitationTable');
  let html = '<thead><tr><th>Domain</th><th>Share</th><th>Δ</th></tr></thead><tbody>';
  week.unbrandedCitations.forEach(d => {
    const cls = d.highlight ? ' class="highlight"' : '';
    const name = d.highlight ? '<strong>' + d.domain + '</strong>' : d.domain;
    let dBadge = '';
    if (d.delta === null || d.delta === undefined) dBadge = '<span class="badge badge-baseline">—</span>';
    else if (d.delta === 0) dBadge = '<span class="badge badge-grey">—</span>';
    else {
      const sign = d.delta > 0 ? '+' : '';
      const badgeCls = d.delta > 0 ? 'badge-green' : 'badge-red';
      dBadge = `<span class="badge ${badgeCls}">${sign}${d.delta}pp</span>`;
    }
    html += `<tr${cls}><td>${name}</td><td>${d.share}%</td><td>${dBadge}</td></tr>`;
  });
  el.innerHTML = html + '</tbody>';
}

// COMPETITION TAB
function renderCompetition() {
  const week = weekData[currentWeekIdx];
  const comp = week.competition;
  if (!comp) return;

  // SOV Bars
  const bars = document.getElementById('sovBars');
  const maxSOV = comp.sov.rokt;
  const barData = [
    { name: 'Rokt', val: comp.sov.rokt, cls: 'rokt' },
    { name: 'Fluent', val: comp.sov.fluent, cls: 'fluent' },
    { name: 'Uptick', val: comp.sov.uptick, cls: 'uptick' },
    { name: 'ThanksCo', val: comp.sov.thanksCo, cls: 'thanksCo' }
  ];
  bars.innerHTML = barData.map(b => `
    <div class="competitor-bar">
      <div class="competitor-bar-label">${b.name}</div>
      <div class="competitor-bar-track">
        <div class="competitor-bar-fill ${b.cls}" style="width: ${Math.max((b.val / maxSOV) * 100, 6)}%">${b.val}%</div>
      </div>
    </div>
  `).join('');

  // SOV Trend Table
  const prevComp = currentWeekIdx > 0 ? weekData[currentWeekIdx - 1].competition : null;
  const sovTable = document.getElementById('sovTrendTable');
  let html = '<thead><tr><th>Company</th><th>SOV This Week</th><th>Δ</th></tr></thead><tbody>';
  ['rokt', 'fluent', 'uptick', 'thanksCo'].forEach(key => {
    const label = key === 'rokt' ? '<strong>Rokt</strong>' : key === 'fluent' ? 'Fluent Inc' : key === 'uptick' ? 'Uptick' : 'ThanksCo';
    const cur = comp.sov[key];
    const prev = prevComp ? prevComp.sov[key] : null;
    let dBadge = '';
    if (prev === null) dBadge = '<span class="badge badge-baseline">Baseline</span>';
    else {
      const delta = (cur - prev).toFixed(2);
      if (Math.abs(delta) < 0.01) dBadge = '<span class="badge badge-grey">—</span>';
      else {
        const sign = delta > 0 ? '+' : '';
        const cls = delta > 0 ? 'badge-green' : 'badge-red';
        dBadge = `<span class="badge ${cls}">${sign}${delta}pp</span>`;
      }
    }
    html += `<tr><td>${label}</td><td>${cur}%</td><td>${dBadge}</td></tr>`;
  });
  sovTable.innerHTML = html + '</tbody>';

  // SOV inline insight
  const sovInsightData = week.insights.competition ? week.insights.competition.sov : null;
  renderInlineInsight('sovInsight', sovInsightData);

  // Sentiment by Platform
  if (comp.sentimentByPlatform) {
    const spTable = document.getElementById('compSentimentPlatformTable');
    let h = '<thead><tr><th>Platform</th><th>Rokt</th><th>Fluent</th><th>Uptick</th><th>ThanksCo</th></tr></thead><tbody>';
    Object.entries(comp.sentimentByPlatform).forEach(([plat, vals]) => {
      h += '<tr><td>' + plat + '</td>';
      ['rokt', 'fluent', 'uptick', 'thanksCo'].forEach(key => {
        const v = vals[key];
        if (v === null || v === undefined) { h += '<td style="color:var(--grey-400)">—</td>'; return; }
        const beats = key !== 'rokt' && v > vals.rokt;
        h += `<td${beats ? ' class="highlight"' : ''}>${key === 'rokt' ? '<strong>' + v + '%</strong>' : v + '%'}${beats ? ' ↑' : ''}</td>`;
      });
      h += '</tr>';
    });
    spTable.innerHTML = h + '</tbody>';
  }
  const spInsightData = week.insights.competition ? week.insights.competition.sentimentPlatform : null;
  renderInlineInsight('sentimentPlatformInsight', spInsightData);

  // Sentiment by Topic
  if (comp.sentimentByTopic) {
    const stTable = document.getElementById('compSentimentTopicTable');
    let h = '<thead><tr><th>Topic</th><th>Rokt</th><th>Fluent</th><th>Uptick</th><th>ThanksCo</th></tr></thead><tbody>';
    Object.entries(comp.sentimentByTopic).forEach(([topic, vals]) => {
      h += '<tr><td>' + topic + '</td>';
      ['rokt', 'fluent', 'uptick', 'thanksCo'].forEach(key => {
        const v = vals[key];
        const beats = key !== 'rokt' && v > vals.rokt;
        h += `<td${beats ? ' class="highlight"' : ''}>${key === 'rokt' ? '<strong>' + v + '%</strong>' : v + '%'}${beats ? ' ↑' : ''}</td>`;
      });
      h += '</tr>';
    });
    stTable.innerHTML = h + '</tbody>';
  }
  const stInsightData = week.insights.competition ? week.insights.competition.sentimentTopic : null;
  renderInlineInsight('sentimentTopicInsight', stInsightData);

  // Themes
  if (comp.themes) {
    const themesEl = document.getElementById('sentimentThemes');
    let th = '';
    const themeLabels = { rokt: 'Rokt', fluent: 'Fluent Inc', uptick: 'Uptick', thanksCo: 'ThanksCo' };
    Object.entries(comp.themes).forEach(([key, themes]) => {
      th += `<div style="margin-bottom: 14px;"><strong style="font-size: 13px;">${themeLabels[key]}</strong><div style="margin-top: 6px;">`;
      themes.forEach(t => { th += `<span class="theme-tag neg">${t}</span>`; });
      th += '</div></div>';
    });
    themesEl.innerHTML = th;
  }

  // Spillover
  const spillTable = document.getElementById('spilloverTable');
  let sp = '<thead><tr><th>Competitor</th><th>Topic</th><th>This Week</th><th>Δ</th></tr></thead><tbody>';
  const prevFluent = prevComp ? prevComp.fluentSpillover || {} : {};
  Object.entries(comp.fluentSpillover || {}).forEach(([topic, val]) => {
    const prev = prevFluent[topic] || 0;
    const delta = val - prev;
    let dBadge = '';
    if (delta > 0) dBadge = `<span class="badge badge-red">+${delta}</span>`;
    else if (delta === 0) dBadge = '<span class="badge badge-grey">—</span>';
    else dBadge = `<span class="badge badge-green">${delta}</span>`;
    sp += `<tr><td>Fluent</td><td>${topic}</td><td>${val}</td><td>${dBadge}</td></tr>`;
  });
  const prevUptick = prevComp ? prevComp.uptickSpillover || {} : {};
  Object.entries(comp.uptickSpillover || {}).forEach(([topic, val]) => {
    const prev = prevUptick[topic] || 0;
    sp += `<tr><td>Uptick</td><td>${topic}</td><td>${val}</td><td>${val > prev ? '<span class="badge badge-amber">NEW</span>' : '<span class="badge badge-grey">—</span>'}</td></tr>`;
  });
  Object.entries(comp.thanksCoSpillover || {}).forEach(([topic, val]) => {
    sp += `<tr><td>ThanksCo</td><td>${topic}</td><td>${val}</td><td><span class="badge badge-amber">NEW</span></td></tr>`;
  });
  spillTable.innerHTML = sp + '</tbody>';

  const spillInsightData = week.insights.competition ? week.insights.competition.spillover : null;
  renderInlineInsight('spilloverInsight', spillInsightData);
}

// GAPS TAB
function renderGaps() {
  const week = weekData[currentWeekIdx];

  // Low Performing Topics — table with SOV bar, flags, and inline insights
  const lpTable = document.getElementById('lowPerformingTable');
  const lowTopics = [
    { name: 'Industry Thought Leadership', sov: 0.6, sentiment: 80.5, flags: ['flag-sov'], flagLabels: ['Low SOV'], note: 'rokt.com is 6th in Industry Thought Leadership citations — behind LinkedIn, Forbes, BigCommerce, McKinsey, Bloomreach',
      insight: { tag: 'gap', label: 'Gap', text: 'Industry Thought Leadership is Rokt\'s weakest topic at 0.6% SOV. This is the biggest category growth opportunity — Rokt needs thought leadership content that AI models will reference.' } },
    { name: 'Persona-Led', sov: 0.85, sentiment: 67.3, flags: ['flag-sov','flag-competition'], flagLabels: ['Low SOV','Fluent ahead'], note: 'Fluent beats Rokt on SOV (1.66% vs 0.85%). Only 586 mentions total.',
      insight: { tag: 'competition', label: 'Competition', text: 'Fluent owns more AI share of voice than Rokt in Persona-Led queries (1.66% vs 0.85%). Google AI Overviews barely surfaces Rokt here (32 mentions).' } },
    { name: 'Rokt Product', sov: 9.7, sentiment: 68.8, flags: ['flag-sentiment'], flagLabels: ['Low sentiment'], note: '16,567 mentions (highest volume) but only 68.8% positive. Room to improve at scale.',
      insight: null },
    { name: 'Rokt Pay+', sov: 25.2, sentiment: 71.4, flags: ['flag-sentiment','flag-competition'], flagLabels: ['Sentiment ↓4.2pp','Uptick ahead'], note: 'Copilot only 49.5% positive. Uptick (77.5%) beats Rokt (71.4%) on sentiment.',
      insight: null },
    { name: 'Rokt Catalog', sov: 23.4, sentiment: 76.1, flags: ['flag-sentiment'], flagLabels: ['Sentiment ↓5.4pp'], note: 'Biggest negative sentiment increase this week. Copilot only 58.5% positive.',
      insight: null },
    { name: 'Rokt Upcart', sov: 28.6, sentiment: 69.5, flags: ['flag-position','flag-competition'], flagLabels: ['Position ↓','Uptick ahead'], note: 'Avg position worsening. Uptick (74.2%) beats Rokt (69.5%) on sentiment.',
      insight: null }
  ];
  const maxSOV = Math.max(...lowTopics.map(t => t.sov));

  let lhtml = '<thead><tr><th style="width:170px;">Topic</th><th style="width:200px;">SOV</th><th style="width:90px;">Sentiment</th><th>Issue</th></tr></thead><tbody>';
  lowTopics.forEach(t => {
    const barPct = Math.max((t.sov / maxSOV) * 100, 3);
    const barCls = t.sov < 2 ? 'warning' : '';
    const sentCls = t.sentiment < 70 ? 'color:var(--red)' : '';
    const flags = t.flags.map((f, i) => `<span class="flag-tag ${f}">${t.flagLabels[i]}</span>`).join(' ');
    let row = `<tr>
      <td><strong>${t.name}</strong></td>
      <td><div class="sov-bar-cell"><div class="sov-bar-val">${t.sov}%</div><div class="sov-bar-track"><div class="sov-bar-fill ${barCls}" style="width:${barPct}%"></div></div></div></td>
      <td style="${sentCls};font-weight:600;">${t.sentiment}%</td>
      <td>${flags}<div style="font-size:11px;color:var(--grey-400);margin-top:4px;">${t.note}</div>`;
    if (t.insight) {
      row += `<div class="topic-insight"><span class="insight-tag tag-${t.insight.tag}">${t.insight.label}</span> ${t.insight.text}</div>`;
    }
    row += `</td></tr>`;
    lhtml += row;
  });
  lpTable.innerHTML = lhtml + '</tbody>';

  // Content Gaps — moved up, right after low performing topics
  const cgTable = document.getElementById('contentGapsTable');
  const gaps = [
    { theme: 'Integration Complexity', occ: '9 negative mentions', action: 'Create "How to integrate Rokt in under 30 min" content — counter the complexity narrative with step-by-step guides and time-to-value stories' },
    { theme: 'Pricing Transparency', occ: '5 negative mentions', action: 'Publish pricing framework — AI models cite pricing concerns because no public content addresses it' },
    { theme: 'Ecosystem Dependence', occ: '3 negative mentions', action: 'Highlight platform-agnostic capabilities and open API integrations in product content' },
    { theme: 'Limited Independent Reviews', occ: 'Across all competitors', action: 'Encourage G2/Capterra reviews — Uptick and ThanksCo also flagged for this. More reviews = better AI positioning' },
    { theme: 'Privacy & Data Concerns', occ: '3 negative mentions', action: 'Create dedicated privacy/compliance content that AI models can cite when asked about data practices' }
  ];
  let ghtml = '<thead><tr><th>Negative Theme</th><th>Frequency</th><th>Content Opportunity</th></tr></thead><tbody>';
  gaps.forEach(g => {
    ghtml += `<tr><td><strong>${g.theme}</strong></td><td>${g.occ}</td><td style="font-size:12px;">${g.action}</td></tr>`;
  });
  cgTable.innerHTML = ghtml + '</tbody>';

  // Content gaps insight
  const cgInsight = week.insights.gaps ? week.insights.gaps.find(i => i.text.includes('negative themes')) : null;
  renderInlineInsight('contentGapsInsight', cgInsight);

  // Low Sentiment Topics
  const lsTable = document.getElementById('lowSentimentTable');
  if (week.lowSentiment) {
    let html = '<thead><tr><th>Topic</th><th>Positive Sentiment</th><th>Note</th></tr></thead><tbody>';
    week.lowSentiment.forEach(d => {
      html += `<tr><td><strong>${d.topic}</strong></td><td>${d.rate}%</td><td style="font-size:12px;color:var(--grey-400)">${d.note}</td></tr>`;
    });
    lsTable.innerHTML = html + '</tbody>';
  }
}

// ===== CHARTS =====
let visChart, sovChart, platChart, citChart;

function renderCharts() {
  const labels = weekData.map(w => w.weekOf.replace('End of Week ', ''));
  const beetroot = '#E0004D';
  const blue = '#3498DB';

  if (visChart) visChart.destroy();
  visChart = new Chart(document.getElementById('visibilityChart'), {
    type: 'line',
    data: {
      labels,
      datasets: [
        { label: 'Overall', data: weekData.map(w => w.branded.visibility.value), borderColor: beetroot, backgroundColor: 'rgba(224,0,77,0.1)', fill: true, tension: 0.3, pointRadius: 6, pointBackgroundColor: beetroot },
        { label: 'Non-Branded', data: weekData.map(w => w.unbranded.visibility.value), borderColor: blue, backgroundColor: 'rgba(52,152,219,0.1)', fill: true, tension: 0.3, pointRadius: 6, pointBackgroundColor: blue, borderDash: [5,5] }
      ]
    },
    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top', labels: { boxWidth: 12, font: { size: 11 } } }, tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': ' + ctx.parsed.y + '%' } } }, scales: { y: { min: 0, ticks: { callback: v => v + '%' } }, x: { grid: { display: false } } } }
  });

  if (sovChart) sovChart.destroy();
  sovChart = new Chart(document.getElementById('sovChart'), {
    type: 'line',
    data: {
      labels,
      datasets: [
        { label: 'Overall', data: weekData.map(w => w.branded.sov.value), borderColor: beetroot, backgroundColor: 'rgba(224,0,77,0.1)', fill: true, tension: 0.3, pointRadius: 6, pointBackgroundColor: beetroot },
        { label: 'Non-Branded', data: weekData.map(w => w.unbranded.sov.value), borderColor: blue, backgroundColor: 'rgba(52,152,219,0.1)', fill: true, tension: 0.3, pointRadius: 6, pointBackgroundColor: blue, borderDash: [5,5] }
      ]
    },
    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top', labels: { boxWidth: 12, font: { size: 11 } } }, tooltip: { callbacks: { label: ctx => ctx.dataset.label + ': ' + ctx.parsed.y + '%' } } }, scales: { y: { min: 0, ticks: { callback: v => v + '%' } }, x: { grid: { display: false } } } }
  });

  const week = weekData[currentWeekIdx];
  if (platChart) platChart.destroy();
  platChart = new Chart(document.getElementById('platformChart'), {
    type: 'bar',
    data: {
      labels: week.platforms.labels,
      datasets: [{ label: 'Non-Branded Mentions', data: week.platforms.mentions, backgroundColor: week.platforms.mentions.map((v, i) => `rgba(224, 0, 77, ${1 - i * 0.1})`), borderRadius: 6, barThickness: 28 }]
    },
    options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { display: false }, tooltip: { callbacks: { label: ctx => ctx.parsed.x.toLocaleString() + ' mentions' } } }, scales: { x: { grid: { color: '#F0F0F0' } }, y: { grid: { display: false } } } }
  });

  if (week.citationCategories) {
    if (citChart) citChart.destroy();
    const cc = week.citationCategories;
    citChart = new Chart(document.getElementById('citationPieChart'), {
      type: 'doughnut',
      data: {
        labels: ['Owned (' + cc.owned + '%)', 'Earned Media (' + cc.earned + '%)', 'Social (' + cc.social + '%)', 'Competition (' + cc.competition + '%)', 'Other (' + cc.other + '%)'],
        datasets: [{ data: [cc.owned, cc.earned, cc.social, cc.competition, cc.other], backgroundColor: ['#E0004D', '#3498DB', '#7D3C98', '#F39C12', '#E9ECEF'], borderWidth: 0 }]
      },
      options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { boxWidth: 12, padding: 10, font: { size: 11 } } } } }
    });
  }
}

function renderCitationInsights() {
  const week = weekData[currentWeekIdx];
  const citInsights = week.insights.citations;
  if (!citInsights) return;
  renderInlineInsight('pieChartInsight', citInsights.pieChart);
  renderInlineInsight('topDomainsInsight', citInsights.topDomains);
  renderInlineInsight('unbrandedCitInsight', citInsights.unbrandedCit);
}

function switchTab(tabName, el) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('tab-' + tabName).classList.add('active');
  el.classList.add('active');
}

function updateAll() {
  const week = weekData[currentWeekIdx];
  renderWeekNav();
  renderTLDR();
  renderKPI('kpiBranded', week.branded, brandedConfigs);
  renderBrandedPosition();
  renderKPI('kpiUnbranded', week.unbranded, unbrandedConfigs);
  renderCharts();
  renderTopDomains();
  renderOwnedContent();
  renderUnbrandedCitations();
  renderCitationInsights();
  renderCompetition();
  renderGaps();
  renderInsightStrip('overviewInsights', week.insights.overview);
}

updateAll();
</script>
</body>
</html>