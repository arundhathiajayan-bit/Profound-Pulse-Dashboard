<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rokt — Profound Pulse Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  :root {
    --beetroot: #E0004D;
    --beetroot-dark: #B8003D;
    --beetroot-light: #FFF0F5;
    --dark: #1A1A2E;
    --grey-900: #212529;
    --grey-700: #495057;
    --grey-400: #ADB5BD;
    --grey-200: #E9ECEF;
    --grey-100: #F8F9FA;
    --white: #FFFFFF;
    --green: #2ECC71;
    --red: #E74C3C;
    --amber: #F39C12;
    --blue: #3498DB;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--grey-100);
    color: var(--grey-900);
    line-height: 1.5;
  }

  /* Header — Beetroot */
  .header {
    background: var(--beetroot);
    color: var(--white);
    padding: 24px 40px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .header-left { display: flex; align-items: center; gap: 14px; }
  .header-logo {
    width: 34px; height: 34px; background: rgba(255,255,255,0.2);
    border-radius: 8px; display: flex; align-items: center;
    justify-content: center; font-weight: 700; font-size: 15px;
  }
  .header h1 { font-size: 20px; font-weight: 600; letter-spacing: -0.3px; }
  .header-sub { font-size: 12px; opacity: 0.8; margin-top: 1px; }
  .header-meta { font-size: 13px; opacity: 0.85; display: flex; gap: 20px; align-items: center; }

  /* Nav tabs */
  .nav-tabs {
    background: var(--white);
    border-bottom: 1px solid var(--grey-200);
    padding: 0 40px;
    display: flex; gap: 0;
  }
  .nav-tab {
    padding: 14px 20px; font-size: 14px; font-weight: 500;
    color: var(--grey-700); cursor: pointer; border-bottom: 2px solid transparent;
    transition: all 0.2s;
  }
  .nav-tab:hover { color: var(--grey-900); }
  .nav-tab.active { color: var(--beetroot); border-bottom-color: var(--beetroot); }

  /* Content */
  .content { max-width: 1200px; margin: 0 auto; padding: 28px 40px 60px; }
  .tab-content { display: none; }
  .tab-content.active { display: block; }

  /* Section header */
  .section-title {
    font-size: 13px; font-weight: 600; text-transform: uppercase;
    letter-spacing: 0.8px; color: var(--grey-400); margin-bottom: 14px;
  }

  /* Week navigation bar */
  .week-nav {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 24px; background: var(--white); border-radius: 12px;
    padding: 16px 22px; border: 1px solid var(--grey-200);
  }
  .week-nav-center { text-align: center; }
  .week-nav-date { font-size: 18px; font-weight: 700; color: var(--grey-900); }
  .week-nav-range { font-size: 12px; color: var(--grey-400); margin-top: 2px; }
  .week-nav-btn {
    display: flex; align-items: center; gap: 6px;
    padding: 8px 16px; border-radius: 8px; font-size: 13px;
    font-weight: 500; border: 1px solid var(--grey-200); background: var(--white);
    cursor: pointer; transition: all 0.2s; color: var(--grey-700);
  }
  .week-nav-btn:hover { background: var(--grey-100); border-color: var(--grey-400); }
  .week-nav-btn:disabled { opacity: 0.3; cursor: default; }
  .week-nav-btn:disabled:hover { background: var(--white); border-color: var(--grey-200); }
  .week-nav-dots { display: flex; gap: 6px; justify-content: center; margin-top: 8px; }
  .week-dot {
    width: 8px; height: 8px; border-radius: 50%; background: var(--grey-200);
    cursor: pointer; transition: all 0.2s;
  }
  .week-dot.active { background: var(--beetroot); width: 20px; border-radius: 4px; }

  /* Comparison badge on KPI */
  .kpi-compare-label { font-size: 10px; color: var(--grey-400); margin-top: 8px; font-weight: 500; }

  /* KPI row */
  .kpi-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; margin-bottom: 32px; }
  .kpi-card {
    background: var(--white); border-radius: 12px; padding: 20px 22px;
    border: 1px solid var(--grey-200); transition: box-shadow 0.2s;
  }
  .kpi-card:hover { box-shadow: 0 2px 12px rgba(0,0,0,0.06); }
  .kpi-label { font-size: 12px; color: var(--grey-700); font-weight: 500; margin-bottom: 6px; display: flex; align-items: center; gap: 5px; }
  .kpi-info {
    display: inline-flex; align-items: center; justify-content: center;
    width: 15px; height: 15px; border-radius: 50%; background: var(--grey-200);
    font-size: 10px; font-weight: 700; color: var(--grey-400); cursor: help;
    position: relative; flex-shrink: 0;
  }
  .kpi-info:hover { background: var(--beetroot); color: var(--white); }
  .kpi-tooltip {
    display: none; position: absolute; bottom: 22px; left: 50%; transform: translateX(-50%);
    background: var(--dark); color: var(--white); font-size: 11px; font-weight: 400;
    padding: 8px 12px; border-radius: 6px; width: 220px; text-align: center;
    line-height: 1.4; z-index: 10; white-space: normal;
  }
  .kpi-info:hover .kpi-tooltip { display: block; }
  .kpi-value { font-size: 28px; font-weight: 700; color: var(--grey-900); }
  .kpi-delta { font-size: 13px; font-weight: 600; margin-top: 4px; }
  .kpi-delta.up { color: var(--green); }
  .kpi-delta.down { color: var(--red); }
  .kpi-note { font-size: 11px; color: var(--grey-400); margin-top: 6px; }

  /* Two column layout */
  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 32px; }
  .card {
    background: var(--white); border-radius: 12px; padding: 24px;
    border: 1px solid var(--grey-200);
  }
  .card h3 { font-size: 15px; font-weight: 600; margin-bottom: 16px; }

  /* Chart container */
  .chart-container { position: relative; height: 260px; }

  /* Table */
  .data-table { width: 100%; border-collapse: collapse; font-size: 13px; }
  .data-table th {
    text-align: left; font-weight: 600; font-size: 11px;
    text-transform: uppercase; letter-spacing: 0.5px;
    color: var(--grey-400); padding: 8px 12px; border-bottom: 1px solid var(--grey-200);
  }
  .data-table td { padding: 10px 12px; border-bottom: 1px solid var(--grey-100); }
  .data-table tr:last-child td { border-bottom: none; }

  /* Badge */
  .badge {
    display: inline-block; padding: 2px 8px; border-radius: 4px;
    font-size: 11px; font-weight: 600;
  }
  .badge-green { background: #E8F8F0; color: #1A9955; }
  .badge-red { background: #FDECEC; color: #C0392B; }
  .badge-amber { background: #FEF5E7; color: #B8860B; }
  .badge-baseline { background: var(--grey-100); color: var(--grey-400); }

  /* Insights */
  .insight-list { list-style: none; }
  .insight-item {
    padding: 14px 0; border-bottom: 1px solid var(--grey-100);
    font-size: 14px; color: var(--grey-700); line-height: 1.6;
  }
  .insight-item:last-child { border-bottom: none; }
  .insight-tag {
    display: inline-block; font-size: 10px; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.5px; padding: 2px 6px;
    border-radius: 3px; margin-right: 8px; vertical-align: middle;
  }
  .tag-citation { background: #EBF5FB; color: #2471A3; }
  .tag-gap { background: #FDEDEC; color: #C0392B; }
  .tag-platform { background: #F4ECF7; color: #7D3C98; }
  .tag-sentiment { background: #FEF9E7; color: #B7950B; }
  .tag-action { background: #E8F8F0; color: #1A9955; }

  /* Responsive */
  @media (max-width: 900px) {
    .kpi-row { grid-template-columns: repeat(2, 1fr); }
    .two-col { grid-template-columns: 1fr; }
    .content { padding: 20px; }
    .header { padding: 20px; }
    .nav-tabs { padding: 0 20px; }
  }

  /* Full width card */
  .full-card { margin-bottom: 24px; }

  /* Insights week selector */
  .insights-week-select {
    padding: 6px 12px; border-radius: 6px; font-size: 13px;
    border: 1px solid var(--grey-200); background: var(--white);
    color: var(--grey-700); cursor: pointer; font-weight: 500;
  }
  .section-header-row {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 14px;
  }
</style>
</head>
<body>

<!-- ===== HEADER (Beetroot) ===== -->
<div class="header">
  <div class="header-left">
    <div class="header-logo">R</div>
    <div>
      <h1>Profound Pulse</h1>
      <div class="header-sub">Rokt's AI Visibility Tracker</div>
    </div>
  </div>
  <div class="header-meta">
    <span id="lastUpdated">Last updated: Feb 16, 2026</span>
  </div>
</div>

<!-- ===== NAV TABS ===== -->
<div class="nav-tabs">
  <div class="nav-tab active" onclick="switchTab('overview', this)">Overview</div>
  <div class="nav-tab" onclick="switchTab('citations', this)">Citations & Sources</div>
  <div class="nav-tab" onclick="switchTab('insights', this)">Insights & Gaps</div>
</div>

<div class="content">

  <!-- ===== OVERVIEW TAB ===== -->
  <div id="tab-overview" class="tab-content active">

    <!-- Week Navigation -->
    <div class="week-nav">
      <button class="week-nav-btn" id="prevWeekBtn" onclick="navigateWeek(-1)">
        <span>&#8592;</span> Previous week
      </button>
      <div class="week-nav-center">
        <div class="week-nav-date" id="weekDateDisplay">Week of Feb 16, 2026</div>
        <div class="week-nav-range" id="weekRangeDisplay">Feb 16 – Feb 22 &middot; Compared to previous week</div>
        <div class="week-nav-dots" id="weekDots"></div>
      </div>
      <button class="week-nav-btn" id="nextWeekBtn" onclick="navigateWeek(1)">
        Next week <span>&#8594;</span>
      </button>
    </div>

    <div class="section-title">Key Metrics</div>
    <div class="kpi-row" id="kpiRow"></div>

    <div class="two-col">
      <div class="card">
        <h3>Visibility Score Over Time</h3>
        <div class="chart-container">
          <canvas id="visibilityChart"></canvas>
        </div>
      </div>
      <div class="card">
        <h3>Share of Voice Over Time</h3>
        <div class="chart-container">
          <canvas id="sovChart"></canvas>
        </div>
      </div>
    </div>

    <div class="card full-card">
      <h3>Non-Branded Mentions by Platform</h3>
      <p style="font-size: 12px; color: var(--grey-400); margin: -10px 0 14px;">When someone asks an AI about a topic without mentioning Rokt, how often does each platform still surface Rokt?</p>
      <div class="chart-container" style="height: 220px;">
        <canvas id="platformChart"></canvas>
      </div>
    </div>

  </div>

  <!-- ===== CITATIONS TAB ===== -->
  <div id="tab-citations" class="tab-content">

    <div class="section-title">Citation Share Breakdown</div>
    <p style="font-size: 13px; color: var(--grey-700); margin: -8px 0 20px;">How AI models cite and reference Rokt content across answer engines</p>

    <div class="two-col">
      <div class="card">
        <h3>Citations by Source Type</h3>
        <p style="font-size: 12px; color: var(--grey-400); margin: -10px 0 14px;">Proportion of AI citations pointing to each content category</p>
        <div class="chart-container">
          <canvas id="citationPieChart"></canvas>
        </div>
      </div>
      <div class="card">
        <h3>Top Cited Domains</h3>
        <p style="font-size: 12px; color: var(--grey-400); margin: -10px 0 14px;">Most frequently cited sources in AI-generated responses about Rokt</p>
        <table class="data-table">
          <thead><tr><th>Domain</th><th>Share</th><th>Type</th></tr></thead>
          <tbody>
            <tr><td>rokt.com</td><td>20.3%</td><td><span class="badge badge-green">Owned</span></td></tr>
            <tr><td>shopify.com</td><td>2.5%</td><td><span class="badge badge-amber">Third Party</span></td></tr>
            <tr><td>linkedin.com</td><td>2.1%</td><td><span class="badge badge-amber">Social</span></td></tr>
            <tr><td>techtimes.com</td><td>1.8%</td><td><span class="badge badge-amber">Earned</span></td></tr>
            <tr><td>glassdoor.com</td><td>1.4%</td><td><span class="badge badge-amber">Social</span></td></tr>
            <tr><td>reddit.com</td><td>1.2%</td><td><span class="badge badge-amber">Social</span></td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="card full-card">
      <h3>Owned Content Citation Breakdown</h3>
      <p style="font-size: 12px; color: var(--grey-400); margin: -10px 0 14px;">How Rokt's own web properties are cited across AI responses</p>
      <table class="data-table">
        <thead><tr><th>Content Type</th><th>Citation Share</th><th>Top Page</th></tr></thead>
        <tbody>
          <tr><td>Blogs</td><td>6.53%</td><td>What Features Differentiate Rokt (1.23%)</td></tr>
          <tr><td>Product Pages</td><td>4.86%</td><td>Biggest movers this week</td></tr>
          <tr><td>Docs / Help Center</td><td>3.44%</td><td>—</td></tr>
          <tr><td>Other Owned</td><td>4.97%</td><td>—</td></tr>
        </tbody>
      </table>
    </div>

    <div class="card full-card">
      <h3>Non-Branded Mentions by Topic</h3>
      <p style="font-size: 12px; color: var(--grey-400); margin: -10px 0 6px;">When someone asks an AI about a topic without mentioning Rokt, how often does Rokt still appear? Broken down by query category.</p>
      <p style="font-size: 15px; color: var(--grey-900); margin-bottom: 16px; font-weight: 600;">Rokt surfaces in <span style="color: var(--beetroot);">41%</span> of non-branded queries overall</p>
      <table class="data-table">
        <thead><tr><th>Query Category</th><th>Mention Rate</th><th>Status</th></tr></thead>
        <tbody>
          <tr>
            <td>Post-Purchase Monetization</td><td>57%</td>
            <td><span class="badge badge-green">Strong</span></td>
          </tr>
          <tr>
            <td>Ecommerce Monetization</td><td>51%</td>
            <td><span class="badge badge-green">Strong</span></td>
          </tr>
          <tr>
            <td>vs. Rebuy</td><td>26%</td>
            <td><span class="badge badge-red">Weak</span></td>
          </tr>
          <tr>
            <td>vs. ReConvert</td><td>24%</td>
            <td><span class="badge badge-red">Weak</span></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ===== INSIGHTS TAB ===== -->
  <div id="tab-insights" class="tab-content">

    <div class="section-header-row">
      <div class="section-title" style="margin-bottom:0;">Weekly Insights</div>
      <select class="insights-week-select" id="insightsWeekSelect" onchange="switchInsightsWeek(this.value)">
      </select>
    </div>
    <div class="card full-card" id="insightsCard">
      <!-- Populated by JS -->
    </div>

    <div class="section-title">Topic Gaps</div>
    <p style="font-size: 13px; color: var(--grey-700); margin: -8px 0 20px;">Topics where Rokt has low or declining AI visibility — these represent content opportunities</p>
    <div class="two-col">
      <div class="card">
        <h3>Industry Thought Leadership</h3>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
          <span style="font-size: 28px; font-weight: 700;">2.3%</span>
          <span class="badge badge-red">-1.9 pp vs. prev week</span>
        </div>
        <p style="font-size: 13px; color: var(--grey-700); margin-bottom: 12px;">Ranked #7. Across 54 prompts, AI responses cite competitor and industry sources over Rokt.</p>
        <div class="section-title" style="margin-bottom: 8px;">Top Negative Themes</div>
        <div style="display: flex; flex-wrap: wrap; gap: 6px;">
          <span class="badge badge-red">Limited Thought Leadership</span>
          <span class="badge badge-red">No Independent Validation</span>
          <span class="badge badge-red">Low Community Engagement</span>
          <span class="badge badge-red">No Published Insights</span>
        </div>
      </div>
      <div class="card">
        <h3>Persona-Led</h3>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
          <span style="font-size: 28px; font-weight: 700;">0.8%</span>
          <span class="badge badge-red">Near invisible</span>
        </div>
        <p style="font-size: 13px; color: var(--grey-700); margin-bottom: 12px;">Highest negative sentiment of any topic (19%). Only 3 prompts tracked — needs expansion.</p>
        <div class="section-title" style="margin-bottom: 8px;">Top Issues</div>
        <div style="display: flex; flex-wrap: wrap; gap: 6px;">
          <span class="badge badge-red">Integration Complexity</span>
          <span class="badge badge-red">No Independent Reviews</span>
          <span class="badge badge-red">No Performance Benchmarks</span>
        </div>
      </div>
    </div>

    <div class="section-title">Content Gaps</div>
    <p style="font-size: 13px; color: var(--grey-700); margin: -8px 0 20px;">Narratives where competitors are positioned more favorably than Rokt in AI responses</p>
    <div class="card full-card">
      <table class="data-table">
        <thead><tr><th>Gap</th><th>Issue</th><th>Impact</th></tr></thead>
        <tbody>
          <tr>
            <td><strong>Advertiser Positioning</strong><br><span style="font-size:11px;color:var(--grey-400)">vs. Uptick</span></td>
            <td style="font-size:13px;">Rokt only appears as publisher/merchant solution, not advertiser platform</td>
            <td style="font-size:13px;">Missing half the value proposition — losing advertiser consideration</td>
          </tr>
          <tr>
            <td><strong>Integration Complexity</strong><br><span style="font-size:11px;color:var(--grey-400)">vs. Uptick</span></td>
            <td style="font-size:13px;">Uptick framed as "simple, one-line integration" — our breadth reads as complexity</td>
            <td style="font-size:13px;">Losing merchants who prioritize ease over sophistication</td>
          </tr>
          <tr>
            <td><strong>New Customer Acquisition</strong><br><span style="font-size:11px;color:var(--grey-400)">vs. Fluent</span></td>
            <td style="font-size:13px;">Fluent owns "lookalike audience" and top-of-funnel — Rokt positioned as bottom-funnel only</td>
            <td style="font-size:13px;">Pigeonholed as checkout monetization, not full-funnel solution</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<script>
// ===== DATA STORE =====
const weekData = [
  {
    weekOf: 'Feb 9, 2026',
    range: 'Feb 9 – Feb 15',
    isBaseline: true,
    metrics: {
      visibility: { value: 22.6, delta: null, note: 'Baseline — first week of tracking' },
      sov: { value: 4.4, delta: null, note: 'Baseline' },
      avgPos: { value: 2.2, delta: null, note: 'Baseline (1 = top position)' },
      citation: { value: 5.6, delta: null, note: 'Baseline' },
      sentiment: { value: 79.4, delta: null, note: 'Baseline' }
    },
    insights: [
      { tag: 'platform', tagLabel: 'Platform', text: 'Grok strongest (35.7% visibility), Perplexity weakest (11.4%). Sentiment averages 83% but drops below 75% on ChatGPT.' },
      { tag: 'citation', tagLabel: 'Citation', text: 'Blogs (owned and third-party) are the top-cited content type across platforms. Rokt\'s website, Shopify, and LinkedIn are the most frequently cited sources.' },
      { tag: 'sentiment', tagLabel: 'Sentiment', text: 'Negative sentiment clusters around integration complexity, pricing transparency, and customer experience callouts.' },
      { tag: 'gap', tagLabel: 'Gap', text: 'Culture and competitive queries perform well (93% and 72% mention rates); all product-specific queries return 0% as they were only added in the last 3 days.' }
    ]
  },
  {
    weekOf: 'Feb 16, 2026',
    range: 'Feb 16 – Feb 22',
    isBaseline: false,
    metrics: {
      visibility: { value: 55.4, delta: 26.1, note: 'Biggest shift: Perplexity, Meta, Google AI Overviews' },
      sov: { value: 13.2, delta: 8.8, note: '' },
      avgPos: { value: 1.3, delta: 0.9, note: '1 = top position. Improved by 0.9 positions' },
      citation: { value: 20.3, delta: 14.7, note: 'rokt.com cited 8x more than next domain' },
      sentiment: { value: 76.9, delta: -2.5, note: 'Decrease driven by Grok and ChatGPT' }
    },
    insights: [
      { tag: 'citation', tagLabel: 'Citation', text: 'Owned content makes up 19.8% of total citation share — blogs lead at 6.53%, then product pages at 4.86%, docs at 3.44%. Earned media is 8.1%, led by TechTimes, BusinessSystemGuide, and a new Aftersell review on Linktly.' },
      { tag: 'citation', tagLabel: 'Citation', text: 'The differentiation blog remains the single highest-cited owned page at 1.23%.' },
      { tag: 'platform', tagLabel: 'Platform', text: 'Google Gemini (57%) and Microsoft Copilot (53%) surface Rokt most often in non-branded queries. Meta AI (23%) is strongest for branded visibility but weakest for non-branded mentions — it responds well to "Rokt" prompts but doesn\'t associate Rokt with broader category queries yet.' },
      { tag: 'sentiment', tagLabel: 'Sentiment', text: 'Integration complexity, pricing transparency and limited independent reviews across Rokt Pay+, Upcart and Persona-Led queries are driving negative sentiment — mainly on Grok and ChatGPT.' },
      { tag: 'gap', tagLabel: 'Gap', text: 'Competitor content (Uptick, Fluent, Thanks.co) appears heavily in Industry Thought Leadership and Persona-Led responses despite only 0.8% of total citations. They\'re treated as authoritative in our gap topics.' }
    ]
  }
];

let currentWeekIdx = weekData.length - 1; // default to latest

const metricConfig = [
  { key: 'visibility', label: 'Visibility Score', suffix: '%', desc: 'How often Rokt appears in AI-generated answers' },
  { key: 'sov', label: 'Share of Voice', suffix: '%', desc: 'Mentions of Rokt in AI answers relative to competitors. Competitors are based on who else surfaces in AI responses, not Rokt-defined competitors.' },
  { key: 'avgPos', label: 'Avg Position', suffix: '', lower: true, desc: 'Average rank of Rokt in AI-generated answers. 1 = top position.' },
  { key: 'citation', label: 'Citation Share', suffix: '%', desc: 'How often rokt.com is cited as a source in AI-generated answers' },
  { key: 'sentiment', label: 'Positive Sentiment', suffix: '%', desc: 'Share of AI mentions where Rokt is framed positively' }
];

// ===== RENDER KPIs =====
function renderKPIs() {
  const week = weekData[currentWeekIdx];
  const row = document.getElementById('kpiRow');
  row.innerHTML = '';

  metricConfig.forEach(cfg => {
    const m = week.metrics[cfg.key];
    const card = document.createElement('div');
    card.className = 'kpi-card';

    let deltaHTML = '';
    if (m.delta !== null) {
      const cls = (cfg.key === 'avgPos') ? (m.delta > 0 ? 'up' : 'down') :
                  (m.delta > 0 ? 'up' : 'down');
      const sign = m.delta > 0 ? '+' : '';
      const arrow = m.delta > 0 ? '↑' : '↓';
      const unit = cfg.suffix === '%' ? ' pp' : ' pos';
      deltaHTML = `<div class="kpi-delta ${cls}">${arrow} ${sign}${m.delta}${unit} vs. prev week</div>`;
    } else {
      deltaHTML = `<div class="kpi-delta" style="color:var(--grey-400);"><span class="badge badge-baseline">Baseline</span></div>`;
    }

    card.innerHTML = `
      <div class="kpi-label">${cfg.label} <span class="kpi-info">i<span class="kpi-tooltip">${cfg.desc}</span></span></div>
      <div class="kpi-value">${m.value}${cfg.suffix}</div>
      ${deltaHTML}
      ${m.note ? `<div class="kpi-note">${m.note}</div>` : ''}
    `;
    row.appendChild(card);
  });
}

// ===== WEEK NAVIGATION =====
function renderWeekNav() {
  const week = weekData[currentWeekIdx];
  document.getElementById('weekDateDisplay').textContent = 'Week of ' + week.weekOf;

  let rangeText = week.range;
  if (week.isBaseline) {
    rangeText += ' \u00b7 Baseline (first week of tracking)';
  } else {
    rangeText += ' \u00b7 Compared to previous week';
  }
  document.getElementById('weekRangeDisplay').textContent = rangeText;

  document.getElementById('prevWeekBtn').disabled = (currentWeekIdx === 0);
  document.getElementById('nextWeekBtn').disabled = (currentWeekIdx === weekData.length - 1);

  // Dots
  const dotsContainer = document.getElementById('weekDots');
  dotsContainer.innerHTML = '';
  weekData.forEach((w, i) => {
    const dot = document.createElement('div');
    dot.className = 'week-dot' + (i === currentWeekIdx ? ' active' : '');
    dot.title = 'Week of ' + w.weekOf;
    dot.onclick = () => { currentWeekIdx = i; updateAll(); };
    dotsContainer.appendChild(dot);
  });

  // Update header
  document.getElementById('lastUpdated').textContent = 'Last updated: ' + weekData[weekData.length - 1].weekOf;
}

function navigateWeek(dir) {
  const newIdx = currentWeekIdx + dir;
  if (newIdx >= 0 && newIdx < weekData.length) {
    currentWeekIdx = newIdx;
    updateAll();
  }
}

function updateAll() {
  renderWeekNav();
  renderKPIs();
  renderInsightsSelect();
  renderInsights(currentWeekIdx);
}

// ===== TABS =====
function switchTab(tabName, el) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  document.getElementById('tab-' + tabName).classList.add('active');
  el.classList.add('active');
}

// ===== INSIGHTS =====
function renderInsightsSelect() {
  const select = document.getElementById('insightsWeekSelect');
  select.innerHTML = '';
  weekData.forEach((w, i) => {
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = 'Week of ' + w.weekOf + (w.isBaseline ? ' (Baseline)' : '');
    opt.selected = (i === currentWeekIdx);
    select.appendChild(opt);
  });
}

function switchInsightsWeek(idx) {
  renderInsights(parseInt(idx));
}

function renderInsights(idx) {
  const week = weekData[idx];
  const card = document.getElementById('insightsCard');
  if (!week.insights || week.insights.length === 0) {
    card.innerHTML = '<p style="color: var(--grey-400); font-size: 14px; padding: 12px 0;">No insights available for this week.</p>';
    return;
  }
  let html = '<ul class="insight-list">';
  week.insights.forEach(ins => {
    html += `<li class="insight-item">
      <span class="insight-tag tag-${ins.tag}">${ins.tagLabel}</span>
      ${ins.text}
    </li>`;
  });
  html += '</ul>';
  card.innerHTML = html;
}

// ===== CHARTS =====
const chartColors = {
  beetroot: '#E0004D',
  beetrootLight: 'rgba(224, 0, 77, 0.1)',
  dark: '#1A1A2E',
  blue: '#3498DB',
  blueLight: 'rgba(52, 152, 219, 0.1)',
  grey: '#ADB5BD'
};

const chartLabels = weekData.map(w => {
  // Short date format: "Feb 9"
  return w.weekOf.replace(', 2026', '');
});

// Visibility trend
new Chart(document.getElementById('visibilityChart'), {
  type: 'line',
  data: {
    labels: chartLabels,
    datasets: [{
      label: 'Visibility Score %',
      data: weekData.map(w => w.metrics.visibility.value),
      borderColor: chartColors.beetroot,
      backgroundColor: chartColors.beetrootLight,
      fill: true,
      tension: 0.3,
      pointRadius: 6,
      pointBackgroundColor: chartColors.beetroot,
      pointHoverRadius: 8
    }]
  },
  options: {
    responsive: true, maintainAspectRatio: false,
    plugins: {
      legend: { display: false },
      tooltip: { callbacks: { label: ctx => ctx.parsed.y + '%' } }
    },
    scales: {
      y: { min: 0, max: 100, ticks: { callback: v => v + '%' } },
      x: { grid: { display: false } }
    }
  }
});

// SoV trend
new Chart(document.getElementById('sovChart'), {
  type: 'line',
  data: {
    labels: chartLabels,
    datasets: [{
      label: 'Share of Voice %',
      data: weekData.map(w => w.metrics.sov.value),
      borderColor: chartColors.blue,
      backgroundColor: chartColors.blueLight,
      fill: true,
      tension: 0.3,
      pointRadius: 6,
      pointBackgroundColor: chartColors.blue,
      pointHoverRadius: 8
    }]
  },
  options: {
    responsive: true, maintainAspectRatio: false,
    plugins: {
      legend: { display: false },
      tooltip: { callbacks: { label: ctx => ctx.parsed.y + '%' } }
    },
    scales: {
      y: { min: 0, max: 30, ticks: { callback: v => v + '%' } },
      x: { grid: { display: false } }
    }
  }
});

// Platform breakdown
new Chart(document.getElementById('platformChart'), {
  type: 'bar',
  data: {
    labels: ['Google Gemini', 'Microsoft Copilot', 'ChatGPT', 'Grok', 'Perplexity', 'Meta AI'],
    datasets: [{
      label: 'Non-Branded Mention Rate',
      data: [57, 53, 40, 36, 29, 23],
      backgroundColor: [
        chartColors.beetroot, chartColors.beetroot,
        'rgba(224, 0, 77, 0.7)', 'rgba(224, 0, 77, 0.5)',
        'rgba(224, 0, 77, 0.35)', 'rgba(224, 0, 77, 0.2)'
      ],
      borderRadius: 6,
      barThickness: 36
    }]
  },
  options: {
    responsive: true, maintainAspectRatio: false,
    indexAxis: 'y',
    plugins: {
      legend: { display: false },
      tooltip: { callbacks: { label: ctx => ctx.parsed.x + '%' } }
    },
    scales: {
      x: { min: 0, max: 70, ticks: { callback: v => v + '%' }, grid: { color: '#F0F0F0' } },
      y: { grid: { display: false } }
    }
  }
});

// Citation pie
new Chart(document.getElementById('citationPieChart'), {
  type: 'doughnut',
  data: {
    labels: ['Owned (Blogs)', 'Owned (Product Pages)', 'Owned (Docs)', 'Earned Media', 'Social', 'Other'],
    datasets: [{
      data: [6.53, 4.86, 3.44, 8.1, 5.5, 71.57],
      backgroundColor: [
        '#E0004D', '#FF4D7D', '#FF8DAB',
        '#3498DB', '#7D3C98', '#E9ECEF'
      ],
      borderWidth: 0
    }]
  },
  options: {
    responsive: true, maintainAspectRatio: false,
    plugins: {
      legend: { position: 'right', labels: { boxWidth: 12, padding: 12, font: { size: 12 } } }
    }
  }
});

// ===== INIT =====
updateAll();
</script>
</body>
</html>
